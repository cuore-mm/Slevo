## 1. 配置ロジックの統合

- [ ] 1.1 `ReplyPopup` の配置計算を単一エントリ関数へ統合し、X/Y計算責務を集約する
- [ ] 1.2 段数別左余白、幅上限、右端見切れ防止の計算順序を固定し、重複ロジックを削除する
- [ ] 1.3 `Int.MAX_VALUE` 等の疑似値を使うフォールバック経路を整理し、未計測時の明示分岐へ置き換える

## 2. テスト再編

- [ ] 2.1 配置計算テストを「段数別左余白」「右端クランプ」「未計測時フォールバック」の観点で再構成する
- [ ] 2.2 リファクタリング前後で代表ケース（1〜4段）の表示結果が仕様内に収まることを確認する
- [ ] 2.3 既存のポップアップ操作契約（タップ起点、重なり、閉じる挙動）に回帰がないことを確認する
