## Context

現在のポップアップ表示は、タップ投稿基準の X 座標をそのまま採用しているため、右側に段が積み上がるとカード幅分が画面外へ出るケースがある。
既存のカードコンテナは水平方向に 4.dp の余白を持つため、右端側だけ余白を固定し、超過分を左へ押し戻す座標計算へ切り替える。
ただし左へ押し戻しすぎると有効表示幅が狭くなるため、左余白の上限を設ける。

## Goals / Non-Goals

**Goals:**
- 右端見切れを防止し、常に右側余白 4.dp を確保する。
- 見切れ防止時は左側余白が増える挙動を許容する。
- 左側余白の拡張量に上限を設け、ポップアップの可読幅を維持する。
- 多段で右にずれる基本挙動は維持する。

**Non-Goals:**
- ポップアップの幅や高さルールの変更。
- 右余白 4.dp の値変更。
- 左余白上限値の動的自動調整。
- 多段の起点計算（タップ投稿基準）そのものの変更。

## Decisions

- **表示 X を右端上限でクランプする**
  - `maxX = screenWidth - popupWidth - rightMarginPx` を上限として、`x = min(desiredX, maxX)` を適用する。
  - クランプで左余白が増えても仕様上許容する。

- **左余白の上限値を追加する**
  - 左余白上限定数 `MAX_LEFT_MARGIN_DP`（初期案: `28.dp`）を導入し、`x = min(x, maxLeftMarginPx)` を適用する。
  - 右端クランプとの組み合わせで `x = min(desiredX, maxX, maxLeftMarginPx)` として扱う。

- **右余白は 4.dp を単一の定数として扱う**
  - カード外側余白契約と同じ値を位置計算で使い、見た目とレイアウト計算を一致させる。

- **Y 座標計算は現行維持**
  - `info.offset.y - info.size.height` の縦方向挙動は現状維持し、今回変更は X 軸のみとする。

## Risks / Trade-offs

- [Risk] カード幅未確定の初期フレームで一時的にクランプが効きにくい可能性。
  - Mitigation: `onGloballyPositioned` 後に再計算される既存挙動を利用し、サイズ確定後の最終位置を保証する。

- [Trade-off] 右端付近では段を重ねるほど左余白が増える。
  - Mitigation: 左余白上限で抑制し、可読幅を確保する。

- [Trade-off] 左余白上限に達したケースでは、段ごとの右方向オフセットが視覚上弱まる。
  - Mitigation: 右見切れ回避と可読性を優先し、段差表現は上限内で維持する。
