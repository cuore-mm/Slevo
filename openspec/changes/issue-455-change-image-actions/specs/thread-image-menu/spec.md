## MODIFIED Requirements

### Requirement: 画像メニューアクション実行の共通化
システムはスレッド画面の画像メニューで選択されたアクション実行を、画像ビューアと共通の実行処理で行うMUST。保存アクションについては、URL正規化・権限判定・保留URL管理・保存実行・結果通知までを画像ビューアと同一フローで処理しなければならないMUST。さらにシステムは対象画像の読み込み状態に応じて表示アクションを制御し、表示されないアクションは選択できないようにしなければならないMUST。

#### Scenario: 読み込み成功時は既存アクションを表示する
- **WHEN** 対象画像が読み込み成功状態で、ユーザーがスレッド画面の画像メニューを開く
- **THEN** システムは既存の成功時アクション（保存・コピー・URLコピー・外部アプリ起動・Googleレンズ・共有・一括保存条件）を表示する

#### Scenario: 404/410失敗時は限定アクションのみ表示する
- **WHEN** 対象画像の読み込み失敗種別が 404 または 410 で、ユーザーがスレッド画面の画像メニューを開く
- **THEN** システムは `NG追加` と `URLコピー` のみを表示し、それ以外のアクションを表示しない

#### Scenario: その他失敗時はレンズを含む失敗向けアクションを表示する
- **WHEN** 対象画像の読み込み失敗種別が 404/410 以外で、ユーザーがスレッド画面の画像メニューを開く
- **THEN** システムは `NG追加`、`URLコピー`、`Googleレンズ` を表示し、それ以外のアクションを表示しない

#### Scenario: 読み込み中は中止アクションを含む読み込み向けアクションを表示する
- **WHEN** 対象画像が読み込み中状態で、ユーザーがスレッド画面の画像メニューを開く
- **THEN** システムは `読み込みを中止`、`NG追加`、`URLコピー`、`Googleレンズ` を表示し、それ以外のアクションを表示しない

#### Scenario: 読み込み中の中止でリトライ導線へ遷移する
- **WHEN** 対象画像が読み込み中状態で、ユーザーが `読み込みを中止` を選択する
- **THEN** システムは対象画像の読み込みを中断し、対象画像をリトライ可能な表示状態へ遷移させる

#### Scenario: 表示対象外アクションは実行されない
- **WHEN** 対象画像状態に対して非表示のアクション実行条件が発生する
- **THEN** システムは当該アクションを実行せず、クラッシュせずに処理を終了する

#### Scenario: 権限許可後に同一対象で保存を再開する
- **WHEN** 保存権限が必要な端末で、表示中の保存アクションを実行後にユーザーが権限許可する
- **THEN** システムは権限要求前に保持した同一URL集合で保存処理を再開する
