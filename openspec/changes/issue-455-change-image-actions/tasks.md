## 1. 状態判定とアクション契約の整理

- [x] 1.1 画像読み込み状態（成功/404-410失敗/その他失敗/読み込み中）を共通に判定できる契約を定義する
- [x] 1.2 状態ごとの表示可能アクション集合（スレッド画面・画像ビューア画面）を実装方針に沿って確定する
- [x] 1.3 新規アクション `読み込みを中止` を共通アクション種別へ追加し、成立条件を「実行時点で読み込み中のみ」に定義する

## 2. スレッド画面の状態連動メニュー実装

- [x] 2.1 `ImageMenuSheet` を状態連動表示へ変更し、404/410・その他失敗・読み込み中で表示項目を切り替える
- [x] 2.2 読み込み中の `読み込みを中止` 選択時に対象画像の読み込みを停止し、リトライ導線へ遷移させる
- [x] 2.3 読み込み完了後に到達した中止操作を no-op として扱い、成功表示を維持する
- [x] 2.4 シート表示中の状態変化でシートを閉じずに内容をアニメーション付き差し替えする
- [x] 2.5 スレッド側の状態入力（失敗種別・読み込み中判定）をメニュー表示判定へ接続する

## 3. 画像ビューア画面の状態連動アクション実装

- [x] 3.1 `ImageViewerTopBar` のその他メニューを状態連動表示へ変更し、要件どおりのアクション制限を適用する
- [x] 3.2 画像読み込み中のみトップバーに `読み込みを中止` アイコンを表示する
- [x] 3.3 `読み込みを中止` 実行時に対象画像の読み込みを停止し、既存リトライUIへ遷移させる
- [x] 3.4 読み込み完了後に到達した中止操作を no-op として扱い、成功表示を維持する
- [x] 3.5 `DropdownMenu` 表示中の状態変化でメニューを閉じずに内容をアニメーション付き差し替えする

## 4. 共通実行経路と回帰確認

- [x] 4.1 `ImageMenuActionRunner` に中止アクション経路を追加し、画面固有コールバック契約を整理する
- [x] 4.2 成功時の既存アクション（保存/共有/コピー/外部起動/検索/一括保存）が従来どおり動作することを確認する
- [x] 4.3 状態別表示・中止遷移・完了競合時no-opを検証する単体テストを追加または更新する
- [x] 4.4 メニュー表示中の状態変化で内容差し替えアニメーションが適用されることを確認する

## 5. 実キャンセルと画面間状態同期の再設計

- [ ] 5.1 画像URL単位の読み込み状態を画面横断で保持する共通状態ストア（単一ソース）を設計し、スレッド/ビューアの表示判定入力を統一する
- [ ] 5.2 URL単位のin-flightリクエストハンドル管理を導入し、`読み込みを中止` で実リクエストを確実にキャンセルする
- [ ] 5.3 URL単位の世代ID（requestId）を導入し、中止後に到達する旧リクエスト由来の成功/失敗通知を無効化する
- [ ] 5.4 スレッド画面で中止したURLをビューア画面表示時にも同一状態で反映し、画面遷移を跨いだUI整合性を確認する
- [ ] 5.5 中止後は明示リトライまで自動再取得しない契約を適用し、必要な単体テスト/統合テスト観点を追加する
