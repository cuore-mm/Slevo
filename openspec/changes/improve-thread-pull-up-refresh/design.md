## Context

Issue #258 では、スレッド画面のプルアップ更新が「意図した操作でのみ発動すること」と「発動可能状態のフィードバック」が求められている。現状は最下部到達中の慣性スクロール延長でも閾値を超えると更新対象になり得るため、誤発動が起きやすい。

対象は `ThreadScreen` の下端オーバースクロール処理であり、`NestedScrollConnection` と下部インジケーター描画ロジックが主な変更点となる。既存の `ThreadScaffold` は `onBottomRefresh` のハンドオフを担うため、大きな責務変更は不要である。

## Goals / Non-Goals

**Goals:**
- 最下部で静止した状態から開始した上方向ドラッグのみを更新判定対象にする。
- 更新閾値の未到達→到達遷移ごとに触覚フィードバックを返す。
- 矢印ベースの状態表示を廃止し、`ContainedLoadingIndicator` ベースの一貫した表示へ統一する。
- インジケーターを画面下部に配置し、ボトムバー高さへ連動して重なりを回避する。

**Non-Goals:**
- 通常の更新トリガー（ツールバーの更新、ジェスチャー更新）の仕様変更。
- データ取得ロジック（`ThreadViewModel.reloadThread`）や通信層の変更。
- iOS/他プラットフォーム向け挙動定義。

## Decisions

### 1) 更新アーム条件を「下端静止後の次ドラッグ」に限定する
- **Decision:** `ThreadScreen` 内で「下端でスクロール停止後に、次のドラッグジェスチャーが開始されたか」を示す状態を持ち、同一ドラッグ連続中のオーバースクロール蓄積を無効化する。
- **Rationale:** 慣性スクロール延長だけでなく、通常スクロールから連続した同一ドラッグでの誤発火も遮断できるため。
- **Alternative:** 単純な `isScrollInProgress` 依存での静止判定は、ドラッグ開始時に自己解除しやすく操作不能を招くため不採用。

### 2) 触覚は閾値の未到達→到達遷移ごとに発火する
- **Decision:** `HapticFeedbackType.GestureThresholdActivate` を用い、未到達→到達へ遷移したタイミングで毎回発火する。到達状態維持中は再発火せず、未到達へ戻った後に再到達した場合は再度発火する。
- **Rationale:** 閾値到達の区切りを明確に伝えつつ、ドラッグ継続中の過剰通知を避けられるため。
- **Alternative:** ジェスチャーあたり1回に固定する案は、再到達時の手応えが失われるため不採用。

### 3) プル中インジケーターを `ContainedLoadingIndicator` 系に統一する
- **Decision:** 矢印アイコンは廃止し、プル中とロード中の表示コンポーネント系統を統一する。
- **Rationale:** Issueコメントの「ContainedLoadingIndicatorに寄せる」要件に整合し、状態変化を自然に見せやすい。
- **Alternative:** 矢印を残して併用する案は視覚言語が混在し、統一要件に反するため不採用。

### 4) 下部インジケーター位置はボトムバー高さ連動にする
- **Decision:** インジケーターの下端オフセットは固定値ではなく、ボトムバー高さを基準に算出する。
- **Rationale:** 端末や表示状態により変化する下部UIとの重なりを避け、常に同じ視認性を維持できるため。
- **Alternative:** 固定値 + Insets 案はボトムバー状態差分を吸収しにくいため不採用。

## Risks / Trade-offs

- [Risk] 下端静止判定が厳しすぎると更新が発動しにくく感じる → Mitigation: 静止判定は「スクロール中フラグ解除後」を基準にし、実機で最小操作回数を確認する。
- [Risk] 触覚発火頻度が高く感じられる場合がある → Mitigation: 到達状態維持中は再発火しない遷移判定に限定する。
- [Risk] 下部バー/ナビゲーションバーとインジケーターが重なる → Mitigation: ボトムバー高さ連動のオフセット計算を採用し、Insetsと併用して安全領域へ配置する。

## Migration Plan

1. `ThreadScreen` のオーバースクロール状態機械を「下端静止後の次ドラッグアーム型」に置換する。
2. 閾値の未到達→到達遷移を検知し、`GestureThresholdActivate` 触覚を発火させる。
3. 矢印表示経路を削除し、`ContainedLoadingIndicator` 系表示に統一する。
4. 既存の `onBottomRefresh` 呼び出し契約を維持したままUI挙動のみ差し替える。
5. ボトムバー高さ連動の表示位置を適用し、手動検証で誤発火抑制とフィードバック挙動を確認する。

## Open Questions

- なし
