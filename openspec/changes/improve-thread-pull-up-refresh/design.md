## Context

Issue #258 では、スレッド画面のプルアップ更新が「意図した操作でのみ発動すること」と「発動可能状態のフィードバック」が求められている。現状は最下部到達中の慣性スクロール延長でも閾値を超えると更新対象になり得るため、誤発動が起きやすい。

対象は `ThreadScreen` の下端オーバースクロール処理であり、`NestedScrollConnection` と下部インジケーター描画ロジックが主な変更点となる。既存の `ThreadScaffold` は `onBottomRefresh` のハンドオフを担うため、大きな責務変更は不要である。

## Goals / Non-Goals

**Goals:**
- 最下部で静止した状態から開始した上方向ドラッグのみを更新判定対象にする。
- 更新閾値を初めて超えた瞬間に 1 回だけ触覚フィードバックを返す。
- 矢印ベースの状態表示を廃止し、`ContainedLoadingIndicator` ベースの一貫した表示へ統一する。
- インジケーターを画面下部に配置し、下部UIと視認性の競合を抑える。

**Non-Goals:**
- 通常の更新トリガー（ツールバーの更新、ジェスチャー更新）の仕様変更。
- データ取得ロジック（`ThreadViewModel.reloadThread`）や通信層の変更。
- iOS/他プラットフォーム向け挙動定義。

## Decisions

### 1) 更新アーム条件を「最下部で静止後」に限定する
- **Decision:** `ThreadScreen` 内で「下端静止が成立したか」を示す状態を持ち、静止成立前のオーバースクロール蓄積を無効化する。
- **Rationale:** 慣性スクロールの延長で発火する経路をUI層で遮断でき、Issue受け入れ条件の「最下部で静止してから」に直接対応できる。
- **Alternative:** `onPostFling` のみで判定を厳格化する案は、ドラッグ開始条件を区別しにくく、誤判定を残しやすいため不採用。

### 2) 触覚は閾値初回跨ぎで 1 回のみ
- **Decision:** 閾値未到達→到達に遷移した瞬間のみ haptic を発火し、到達状態維持中は再発火しない。
- **Rationale:** 発動可能状態の明確化と過剰な振動抑制を両立するため。
- **Alternative:** 到達中に連続発火する案はノイズが大きくUXを悪化させるため不採用。

### 3) プル中インジケーターを `ContainedLoadingIndicator` 系に統一する
- **Decision:** 矢印アイコンは廃止し、プル中とロード中の表示コンポーネント系統を統一する。
- **Rationale:** Issueコメントの「ContainedLoadingIndicatorに寄せる」要件に整合し、状態変化を自然に見せやすい。
- **Alternative:** 矢印を残して併用する案は視覚言語が混在し、統一要件に反するため不採用。

## Risks / Trade-offs

- [Risk] 下端静止判定が厳しすぎると更新が発動しにくく感じる → Mitigation: 静止判定は「スクロール中フラグ解除後」を基準にし、実機で最小操作回数を確認する。
- [Risk] 触覚タイプの差異で端末間体感がずれる → Mitigation: 既存実装と同じ `HapticFeedbackType` を優先し、最小限の追加に留める。
- [Risk] 下部バー/ナビゲーションバーとインジケーターが重なる → Mitigation: 下部余白をInsets基準で確保し、表示位置を安全領域へ寄せる。

## Migration Plan

1. `ThreadScreen` のオーバースクロール状態機械を「静止後アーム型」に置換する。
2. 閾値跨ぎ検知時に haptic 発火を追加する。
3. 矢印表示経路を削除し、インジケーター表示を統一する。
4. 既存の `onBottomRefresh` 呼び出し契約を維持したままUI挙動のみ差し替える。
5. 手動検証で誤発火抑制とフィードバック挙動を確認する。

## Open Questions

- 閾値到達時の触覚タイプを `LongPress` で固定するか、`TextHandleMove` 相当の軽い振動にするか。
- 画面下部インジケーターの最終オフセットを固定値 + Insets で持つか、ボトムバー高さ連動で持つか。
