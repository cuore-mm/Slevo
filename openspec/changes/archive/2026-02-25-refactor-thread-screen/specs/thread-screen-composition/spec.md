## ADDED Requirements

### Requirement: スレッド画面責務の分離構成
システムは `ThreadScreen` 実装において、画面オーケストレーション、スクロール副作用、投稿リスト描画、オーバーレイ表示の責務を分離した構成を維持しなければならないMUST。責務分離後もスレッド画面の既存機能契約を変更してはならないMUST。

#### Scenario: 画面本体がオーケストレーション責務に限定される
- **WHEN** 開発者が `ThreadScreen` の実装を確認する
- **THEN** 画面本体は state と handler の接続および主要コンポーネントの組み立てを担当し、副作用処理と詳細描画ロジックは補助Composableまたは補助関数へ分離されている

#### Scenario: 責務分離後も既存の操作契約が維持される
- **WHEN** ユーザーがスレッド画面でスクロール、レス操作、メニュー表示、画像遷移、ポップアップ表示を行う
- **THEN** システムは分割前と同一の挙動を返し、表示結果と操作フローを変更しない

### Requirement: 副作用トリガーと依存の明確化
システムは `ThreadScreen` の副作用処理において、最終既読更新、自動スクロール、下端更新判定を独立した処理単位として管理し、各処理の依存キーと発火条件を明確に保たなければならないMUST。

#### Scenario: 副作用ごとに依存関係が分離される
- **WHEN** 開発者がスクロール関連副作用の実装を確認する
- **THEN** 最終既読更新、自動スクロール、下端更新判定はそれぞれ独立した処理単位で実装され、不要な状態依存を共有しない

#### Scenario: 下端更新判定のアーム条件が維持される
- **WHEN** ユーザーが下端到達後に次ドラッグで更新操作を行う
- **THEN** システムは既存と同じアーム条件で更新判定を行い、閾値到達時のみ更新処理を実行する

### Requirement: 重複ロジックの一元化
システムはポップアップ基準座標算出や末尾スクロール先算出など、同一意味の補助ロジックを一元化し、同じ条件で常に同じ結果を返さなければならないMUST。

#### Scenario: ポップアップ基準座標が統一される
- **WHEN** 投稿本文タップ、返信元タップ、返信先タップ、IDタップからポップアップが要求される
- **THEN** システムは同一の座標算出ルールを適用し、ポップアップ有無に応じて一貫した基準座標を返す

#### Scenario: 末尾スクロール先の算出が統一される
- **WHEN** ユーザーが「下端へ移動」操作を実行する
- **THEN** システムは投稿数と表示状態に応じた同一算出ルールで対象インデックスを決定する
