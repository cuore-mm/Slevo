## Context

Issue #457 では、スレッド画面のミニマップ付きスクロールバーに表示される現在位置インジケータが、スクロール中にかくついて見える。
現状は `LazyListState.firstVisibleItemIndex` と `visibleItemsInfo.size` の整数値のみで矩形の位置・高さを算出しており、投稿境界をまたぐまで値が更新されないため段階的な移動になる。
変更対象は `MomentumBar` のインジケータ算出ロジックに限定し、既存の勢いグラフや各種マーカー描画、およびミニマップ操作は維持する。

## Goals / Non-Goals

**Goals:**
- 表示中インジケータ上端をスクロールオフセット込みの連続値で計算し、視覚上の段差を解消する。
- 表示中インジケータ高さを可視領域ベースで計算し、部分表示時の不自然な伸縮を抑える。
- ミニマップの既存機能と UI 構成を変えず、Issue #457 の体験劣化のみを局所修正する。

**Non-Goals:**
- 勢いグラフの算出式や色設計の見直し。
- ミニマップのレイアウト変更（幅、配置、表示条件）。
- スレッド本体のスクロールロジックや他画面スクロールバー仕様の変更。

## Decisions

1. `LazyListLayoutInfo` を用いた連続位置計算を採用する。
   - 採用: `firstVisibleItemIndex + firstVisibleItemScrollOffset / firstVisibleItemSize` を基準に、インジケータ上端を浮動小数で算出する。
   - 代替案: `firstVisibleItemIndex` のみを使い `animate*` で補間する。
   - 判断理由: 元の入力値が離散のままだと境界でのジャンプは残るため、根本的に連続値へ置き換える。

2. 高さは「実際に見えている投稿数相当値」で算出する。
   - 採用: `layoutInfo.visibleItemsInfo` の先頭・末尾の可視ピクセル量を用いて可視投稿相当数を求め、`postHeight` に乗算する。
   - 代替案: `visibleItemsInfo.size` の整数値を継続利用する。
   - 判断理由: 整数件数は部分可視を表現できず、スクロールに応じた細かな変化が欠落するため。

3. 補間アニメーションは必須要件にしない。
   - 採用: まず算出値の連続化のみで品質を満たす設計とし、必要時に軽量補間を追加可能な構造にする。
   - 代替案: 常時アニメーション適用を前提にする。
   - 判断理由: 連続算出だけで多くのかくつきは解消でき、追加アニメーションは過剰追従や遅延の副作用を招く可能性がある。

## Risks / Trade-offs

- [Risk] 投稿高さが極端に不均一な場合、単純な投稿相当値換算では矩形挙動が視覚期待とずれる可能性 → Mitigation: 先頭・末尾の可視量を使う方式で誤差を抑え、必要に応じて後続改善で item offset ベースの厳密計算へ拡張する。
- [Risk] `layoutInfo` 参照頻度増加で描画負荷が増える可能性 → Mitigation: 既存 Canvas 描画内で完結させ、追加の重い状態監視やコルーチンを導入しない。
- [Risk] 0 件・1 件・極小ビューポート時の境界条件でゼロ除算や負値が発生する可能性 → Mitigation: `posts.isNotEmpty()` と `coerceIn` を維持し、算出結果を 0..canvasHeight にクランプする。

## Migration Plan

1. `MomentumBar` 内のインジケータ上端・高さ算出を連続値ベースに差し替える。
2. ミニマップ表示有効時に、微小スクロールで矩形が連続移動することを手動確認する。
3. 部分可視状態で矩形高さが段階的に跳ねないことを確認する。
4. 回帰として、勢いグラフ・各種マーカー・ミニマップのタップ/ドラッグ操作が維持されることを確認する。
5. 問題発生時は算出式変更のみをロールバックし、他描画要素は現状維持とする。

## Open Questions

- なし（Issue #457 のスコープ内では、インジケータ描画ロジックの局所修正で完結可能）。
