## Context

現在の失敗分類は `Throwable.message` から `404/410` を正規表現で抽出しており、HTTP 応答コードそのものを参照していません。この方式はメッセージ形式への依存が強く、URL や別種例外に同じ数値が含まれた場合に誤分類を引き起こす可能性があります。

本変更では、404/410 専用表示のトリガーを「HTTP 例外が持つステータスコード」に限定し、分類不能な失敗は `UNKNOWN` にフォールバックさせます。

## Goals / Non-Goals

**Goals:**
- 404/410 判定を型付き HTTP 例外のステータスコード起点へ変更する。
- 非 HTTP 失敗や分類不能失敗を `UNKNOWN` として扱い、再試行導線を維持する。
- 既存 UI 契約（404/410 文言表示、その他失敗のリロード導線）を変えずに誤判定のみを除去する。

**Non-Goals:**
- 404/410 以外のエラー分類カテゴリを追加すること。
- 失敗 UI デザインや文言を変更すること。
- ネットワーク層全体のエラーモデル統一を行うこと。

## Decisions

1. HTTP ステータス判定は例外型ベースで行う。
   - 代替案: 既存 regex を維持し、条件を厳しくする。
   - 採用理由: 文字列形式依存を残す限り誤判定リスクを本質的に解消できないため。

2. 判定対象は cause chain を辿って探索し、最初に見つかった HTTP 例外を採用する。
   - 代替案: トップレベル例外のみを見る。
   - 採用理由: Coil/ライブラリ側ラップで HTTP 例外が内側に入るケースに対応するため。

3. HTTP 404/410 以外、またはステータス不明は `UNKNOWN` とする。
   - 代替案: 4xx/5xx を広く恒久エラー扱いする。
   - 採用理由: 今回の UI 契約は 404/410 のみ専用扱いであり、範囲拡大は別変更で検討すべきため。

## Risks / Trade-offs

- [Risk] 利用ライブラリの例外型差異でステータス取得に漏れが出る
  → Mitigation: 現在利用中のネットワークスタックで発生する HTTP 例外型を実装時に確認し、必要最小限の対応型を明示する。

- [Risk] cause chain 探索が過剰に深いと意図しない型を拾う
  → Mitigation: 探索深度上限を維持し、最短経路の HTTP 例外のみ採用する。

- [Trade-off] メッセージ推測を捨てることで「たまたま拾えていた」404/410 判定が消える
  → Mitigation: それらは仕様上誤判定であるため、`UNKNOWN` への是正を正とする。

## Migration Plan

1. `ImageLoadFailureType` のステータス抽出ロジックをメッセージ regex から型ベース判定へ置換する。
2. 404/410 判定分岐が既存 UI で期待通り維持されることを確認する。
3. 非 HTTP 失敗が `UNKNOWN` に分類され、リロード導線が表示されることを確認する。
4. 回帰として issue #449 の 3 箇所（投稿サムネイル/ビューア本体/下部サムネイル）で誤判定が起きないことを確認する。

## Open Questions

- Coil 由来以外の HTTP 例外（将来的な fetcher 差し替え時）を同一ユーティリティで吸収するかは別途判断が必要。
