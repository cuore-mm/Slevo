## Context

表示キャッシュ再利用の実装では、Coil disk cache のスナップショット実ファイルから拡張子を取り出して共有ファイル名を生成している。実ファイル名は画像拡張子を保証しないため、`content://` URI から推定されるMIMEが画像として解釈されず、共有シートのプレビュー表示が欠落する。

共有機能自体は `ACTION_SEND` と URI 権限付与で成立しているため、回帰の焦点は「共有データの型表現」に限定される。

## Goals / Non-Goals

**Goals:**
- 再利用経路の共有URI生成で画像型情報を安定的に提供し、共有シートの画像プレビューを復旧する。
- スレッド画面と画像ビューア画面の双方で同一メタデータ契約を適用する。
- 再利用不可時の既存フォールバック契約を維持する。

**Non-Goals:**
- 共有遅延改善ロジック全体の再設計。
- 共有UI（準備中表示など）の追加。
- 画像保存フローの変更。

## Decisions

- **再利用レジストリに拡張子/MIMEを保持する**
  - `ReuseEntry` を `diskCacheKey + extension + mimeType + timestamp` に拡張する。
  - 表示成功時にURLと成功結果から型情報を正規化して登録する。

- **共有ファイル生成は再利用メタデータ優先で型を決める**
  - 再利用経路はスナップショット実ファイル名を参照せず、`ReuseEntry.extension` で共有ファイル名を生成する。
  - MIMEは `ReuseEntry.mimeType` を使用し、欠損時のみ `image/jpeg` へフォールバックする。

- **不正値ガードを追加する**
  - 拡張子が空または画像以外と判定される場合は `jpg` を使用する。
  - MIMEが `image/` で始まらない場合は `image/jpeg` を使用する。

## Risks / Trade-offs

- [Risk] URLに拡張子がない場合、登録時推定が不正確になる可能性。
  - Mitigation: MIME優先の正規化を行い、最終的に `jpg`/`image/jpeg` を既定値として統一する。

- [Risk] 既存レジストリとの互換で古いエントリ形式が混在する可能性。
  - Mitigation: 取得時に欠損フィールドを検知して安全既定値を補完する。

- [Trade-off] メタデータ管理は増えるが、共有シート表示の安定性向上を優先する。
