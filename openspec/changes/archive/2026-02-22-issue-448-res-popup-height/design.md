## Context

`ReplyPopup` は現在、画面高の一定比率を最大高さとして全段に共通適用しているため、ポップアップを重ねても各段の見た目差が出にくい。
Issue #448 では「段数に応じた段階的縮小」と「下限値の設定」が求められており、既存の操作契約を保ったままレイアウト制約のみ拡張する必要がある。

## Goals / Non-Goals

**Goals:**
- 2段目以降のポップアップ最大高さを段数に応じて単調に縮小する。
- 段数が増えても可読性を維持できる下限値を適用する。
- 既存のポップアップ操作（タップ、スクロール、アニメーション、遷移識別）を変更しない。

**Non-Goals:**
- ポップアップの横幅、表示位置オフセット、境界線デザインの変更。
- ポップアップスタック追加・削除ルールや重複抑止ルールの変更。
- スレッド本体リストや他画面ダイアログの高さ仕様の統一。

## Decisions

- **段数ベースの高さ比率計算を導入する**
  - `baseRatio - (depth * stepRatio)` で段階縮小し、`minRatio` で下限クランプする。
  - 深い段での過縮小を防ぎつつ、段数差を視覚的に判別しやすくする。

- **比率定数を `ReplyPopup` 内の明示定数として管理する**
  - `BASE_MAX_HEIGHT_RATIO` / `STEP_MAX_HEIGHT_RATIO` / `MIN_MAX_HEIGHT_RATIO` の形で管理し、調整点を一箇所に集約する。
  - 代替案としてハードコード値の直接埋め込みもあるが、将来の調整時に追跡しづらいため採用しない。

- **高さ計算を小さな純粋関数へ分離する**
  - 段数入力に対する比率算出を関数化し、UI描画から分離してテスト可能にする。
  - これにより「単調減少」「下限維持」をユニットテストで固定化できる。

- **既存 `heightIn(max = ...)` 契約を維持して適用値だけ差し替える**
  - レイアウト構造を大きく変えず、段数ごとの `maxHeight` のみ差し替える。
  - 既存スクロールバー表示条件（スクロール可否判定）との互換性を維持する。

## Risks / Trade-offs

- [Risk] 縮小ステップが大きすぎると中段で本文可読性が下がる。
  - Mitigation: 最小比率を設け、代表的な段数（2〜5段）で表示確認する。

- [Risk] 縮小ステップが小さすぎると段数差が視認できない。
  - Mitigation: 1段目と2段目で目視差が確認できる初期値を採用し、必要に応じて定数のみ調整可能にする。

- [Trade-off] 段数依存ロジックが増える分、レイアウト計算の理解コストがわずかに増える。
  - Mitigation: 計算式を関数化し、仕様意図と境界条件をテストで明文化する。
