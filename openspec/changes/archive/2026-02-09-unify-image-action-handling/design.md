## Context

現状は `ThreadScaffold` と `ImageViewerScreen` がそれぞれ `ImageMenuAction` の `when` 分岐を持ち、同じ処理（コピー、共有、外部アプリ起動、検索、保存トリガー、NG登録トリガー）を二重実装している。これにより挙動差分や修正漏れが発生しやすい。

一方で、メニューUIの見せ方（BottomSheet / DropdownMenu）や保存権限要求の流れは画面文脈に依存しており、全体を一度に統一すると変更範囲が大きくなる。

## Goals / Non-Goals

**Goals:**
- 画像アクションの実行分岐を単一点に集約し、両画面で同一アクションの挙動を一致させる。
- 既存UI・既存文言・既存ユーザー操作フローを維持する。
- 今後のアクション追加時に変更箇所を最小化する。

**Non-Goals:**
- BottomSheet と DropdownMenu のUI統一。
- 保存権限要求フローと保存結果トーストの全面統一。
- ViewModel階層や DI 構成の大規模再設計。

## Decisions

### 1) `ui/common` に共通 Action Runner を追加する
- 決定: `ui/common` 配下に `ImageMenuAction` 実行専用のランナーを置く。
- 理由: 既存構造への影響を抑えつつ重複を除去できるため。
- 代替案:
  - ViewModel集約: 画面依存副作用をイベント化する追加設計が必要で、今回スコープでは過大。
  - data/usecase新設: Android UI副作用中心の処理と層責務が合いにくい。

### 2) 画面固有責務はコールバックで分離する
- 決定: ランナーは汎用処理のみ実装し、保存要求・NGダイアログ表示・メニュークローズはコールバック化する。
- 理由: 画面状態管理（UiState/メニュー状態）への直接依存を避け、再利用性を維持するため。
- 代替案:
  - ランナー内で画面状態を直接更新: 依存が強くなり、共通化の価値が下がる。

### 3) URLガードと失敗ハンドリングはランナー側で統一する
- 決定: `targetUrl` 空文字の早期リターン、外部起動不可時トースト、画像取得失敗時トーストをランナー側で一元化する。
- 理由: 同一アクションの異常系挙動を揃えるため。
- 代替案:
  - 画面ごとに個別実装: 既存の重複問題を再発させる。

## Risks / Trade-offs

- [Risk] コールバック引数が増えてランナー呼び出しが複雑化する
  - Mitigation: `deps` 構造体に集約し、必須依存を最小限に限定する。

- [Risk] 既存画面固有仕様を誤って共通化し、挙動差異が出る
  - Mitigation: 非対象（権限要求、トースト文言、メニューUI）を明示し、回帰確認ケースを tasks に明記する。

- [Risk] 非同期処理途中でメニュー状態が不整合になる
  - Mitigation: アクション実行後のクローズ経路を一本化し、各画面で同じタイミングで close を呼ぶ。
