# post-request-encoding Specification

## Purpose
投稿送信時に Shift_JIS 非対応文字を文字化けさせずに正しく送信するための文字変換とフォームエンコードの仕様を定義する。

## Requirements

### Requirement: Shift_JIS 非対応文字の投稿前変換
システムは投稿送信時に、`MESSAGE`/`name`/`mail`/`subject` を含む入力値に含まれる Shift_JIS で表現不能な文字を数値文字参照（NCR）へ変換しなければならないMUST。

#### Scenario: 絵文字を含む本文を返信投稿する
- **WHEN** ユーザーが Shift_JIS 非対応の絵文字を含む本文で返信投稿を実行する
- **THEN** システムは非対応文字を NCR に置換した値を送信し、投稿先で文字化けしない

#### Scenario: 複数コードポイント絵文字を含む本文を送信する
- **WHEN** ユーザーが肌色修飾など複数コードポイントで構成される絵文字を入力する
- **THEN** システムは構成する各コードポイントを欠落なく NCR に変換して送信する

#### Scenario: 名前・メール・件名でも同一変換を適用する
- **WHEN** ユーザーが `name`/`mail`/`subject` に Shift_JIS 非対応文字を入力する
- **THEN** システムは本文と同じ変換ルールで NCR へ置換して送信する

### Requirement: 投稿フォーム値のエンコード経路一元化
システムは投稿フォーム値を URL エンコード済み文字列として手動投入せず、フォームビルダーの文字セット指定に基づく単一経路でエンコードしなければならないMUST。

#### Scenario: 返信投稿の一次送信で一元化経路を使用する
- **WHEN** システムが返信投稿の一次送信リクエストを構築する
- **THEN** システムは未エンコード値をフォームへ追加し、送信時エンコードをフォームビルダーへ委譲する

#### Scenario: スレ立て確認送信で一元化経路を使用する
- **WHEN** システムがスレ立て確認送信リクエストを構築する
- **THEN** システムは hidden parameter を含む全フォーム値で同一のエンコード経路を利用する

### Requirement: Shift_JIS 互換文字の原文維持
システムは Shift_JIS で表現可能な文字について、投稿前変換で文字内容を変更してはならないMUST。

#### Scenario: 日本語テキストのみを送信する
- **WHEN** ユーザー入力が Shift_JIS で表現可能な文字のみで構成される
- **THEN** システムは入力文字列をそのまま保持して送信する
