# image-viewer Specification

## Purpose
TBD - created by archiving change add-image-viewer-swipe. Update Purpose after archive.
## Requirements
### Requirement: レス内画像のスワイプ閲覧
システムは画像ビューアで、同一レス本文から抽出した画像URLを左右スワイプで切り替えられるようにするSHALL。

#### Scenario: 同一レスの画像を横スワイプで切り替える
- **WHEN** ユーザーがレス内の画像サムネイルから画像ビューアを開き、同一レス内に複数画像が存在する
- **THEN** 画像ビューアはレス本文の画像URL順にページを並べ、左右スワイプで切り替えられる

### Requirement: 初期表示画像の一致
システムは画像ビューアを開いた際、タップされた画像URLを初期ページに設定するSHALL。

#### Scenario: タップした画像を初期表示する
- **WHEN** ユーザーがレス内の画像サムネイルをタップして画像ビューアを開く
- **THEN** 画像ビューアは該当URLの画像を最初に表示する

### Requirement: 切替対象の限定
システムは画像ビューアの切替対象を同一レス本文から抽出した画像URLに限定するSHALL。

#### Scenario: 他レスの画像を含めない
- **WHEN** ユーザーが画像ビューアを開く
- **THEN** 切り替え可能な画像は同じレス本文から抽出されたURLのみで構成される

### Requirement: サムネイルバーの表示
システムは画像ビューア下部に、同一レス本文から抽出した画像URLのサムネイルを横並びで表示するSHALL。

#### Scenario: 同一レス内画像のサムネイルを表示する
- **WHEN** ユーザーが画像ビューアを開く
- **THEN** 画像ビューア下部に同一レス本文の画像サムネイルが横並びで表示される

### Requirement: サムネイル表示の連動
システムは画像ビューアの上部バー表示と連動してサムネイルバーの表示/非表示を切り替えるSHALL。

#### Scenario: タップでバー表示を切り替える
- **WHEN** ユーザーが画像をタップして上部バー表示を切り替える
- **THEN** サムネイルバーの表示も同様に切り替わる

### Requirement: 表示中サムネイルの強調と中央寄せ
システムは表示中の画像サムネイルを少し拡大して強調し、サムネイル一覧の中央に表示するようスクロールするSHALL。

#### Scenario: 現在表示中のサムネイルが中央に位置する
- **WHEN** ユーザーが画像をスワイプ、またはサムネイルをタップして表示画像が切り替わる
- **THEN** 該当サムネイルが拡大表示され、サムネイル一覧の中央付近に表示される

### Requirement: サムネイルタップで切替
システムはサムネイルをタップしたとき、その画像に表示を切り替えるSHALL。

#### Scenario: サムネイルタップで表示画像を変更する
- **WHEN** ユーザーがサムネイルをタップする
- **THEN** 画像ビューアの表示がタップした画像に切り替わる

### Requirement: 画像ビューアトップバーの保存操作
システムは画像ビューアのトップバーに保存アクションを表示し、現在表示中の画像に対して保存操作を開始できるようにするSHALL。保存開始時は権限状態を確認し、必要な場合は権限要求を経由して同一の保存フローを継続しなければならないMUST。

#### Scenario: 保存ボタンから現在画像を保存する
- **WHEN** ユーザーが画像ビューアのトップバーにある保存ボタンをタップする
- **THEN** システムは現在表示中の画像を保存対象として保存処理を開始する

#### Scenario: 権限が必要な端末で保存権限を要求する
- **WHEN** 保存操作開始時に端末が保存権限を要求し、権限が未許可である
- **THEN** システムは保存対象URLを保持したまま権限要求を表示し、許可後に同じ対象で保存処理を再開する

### Requirement: 画像ビューアトップバーのその他メニュー
システムは画像ビューアのトップバーにその他アクションボタンを表示し、押下時に `DropdownMenu` で単体保存以外の既存画像アクションを選択できるようにするSHALL。

#### Scenario: その他ボタンで追加アクションを表示する
- **WHEN** ユーザーが画像ビューアのトップバーにあるその他ボタンをタップする
- **THEN** システムは `DropdownMenu` を表示し、単体保存を除く既存画像アクションを表示する

#### Scenario: バー非表示時はメニューを閉じる
- **WHEN** ユーザー操作により画像ビューアのバー表示がオフになる
- **THEN** システムは表示中の `DropdownMenu` を閉じる

### Requirement: その他メニューのアクション実行
システムは画像ビューアのその他メニューで選択されたアクションを、既存の画像アクションと同等の処理で実行するSHALL。

#### Scenario: コピー/共有/外部アプリ起動/検索を実行する
- **WHEN** ユーザーがその他メニューからコピー、共有、外部アプリ起動、検索のいずれかを選択する
- **THEN** システムは現在表示中画像を対象に既存画像アクションと同等の処理を実行する

#### Scenario: その他メニューから一括保存を実行する
- **WHEN** 画像ビューアに複数画像があり、ユーザーがその他メニューから一括保存を選択する
- **THEN** システムは表示中レスの画像一覧を保存対象として保存処理を開始する

### Requirement: サムネイルバーのスクロールによる表示切替
システムはサムネイルバーのスクロール中、表示領域の中心に最も近いサムネイルを選択状態として扱い、表示画像をリアルタイムで切り替えるSHALL。

#### Scenario: 中央サムネイルに合わせて表示画像が切り替わる
- **WHEN** ユーザーがサムネイルバーをスクロールする
- **THEN** 中央に最も近いサムネイルが選択状態として拡大表示され、画像ビューアの表示がその画像に切り替わる

### Requirement: 画像ビューアアクション実行の共通化
システムは画像ビューアの保存ボタンおよびその他メニューから起動する画像アクションを、スレッド画面と共通の実行処理で行うMUST。保存アクションについては、権限判定・保留URL管理・保存結果通知の判定ロジックをスレッド画面と同一契約で実行しなければならないMUST。

#### Scenario: 共通ランナーで画像アクションを実行する
- **WHEN** ユーザーが画像ビューアでコピー、共有、外部アプリ起動、Web検索、保存のいずれかを選択する
- **THEN** システムはスレッド画面と同じ実行契約に従って対象画像に対する処理を開始する

#### Scenario: メニュー種別が異なっても処理契約は同じ
- **WHEN** スレッド画面はBottomSheet、画像ビューアはDropdownMenuから同一アクションを選択する
- **THEN** システムは同じ入力条件に対して同じ成功系・失敗系の実行結果を提供する

#### Scenario: 保存結果通知をスレッド画面と同一文言で表示する
- **WHEN** 画像ビューアで単体保存または一括保存が完了する
- **THEN** システムはスレッド画面と同一の判定条件（単体成功/単体失敗/全成功/全失敗/部分成功）で結果通知を表示する

