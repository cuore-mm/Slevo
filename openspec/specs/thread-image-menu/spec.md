# thread-image-menu Specification

## Purpose
TBD - created by archiving change add-batch-image-save. Update Purpose after archive.
## Requirements
### Requirement: レス内画像の一括保存
システムは画像メニューに「レス内の画像をすべて保存」を提供し、選択時に対象レス本文の画像URLをまとめて保存するSHALL。

#### Scenario: レス内画像をまとめて保存する
- **WHEN** ユーザーが画像サムネイルを長押しして「レス内の画像をすべて保存」を選択する
- **THEN** レス本文から抽出した画像URLを一括で保存する

#### Scenario: 同一URLは1回だけ保存する
- **WHEN** レス本文に同一の画像URLが複数回含まれる
- **THEN** 当該URLの保存処理は1回だけ実行される

#### Scenario: 画像が1件のみの場合はメニューを表示しない
- **WHEN** 対象レス本文に画像URLが1件だけ含まれる
- **THEN** 「レス内の画像をすべて保存」は表示されない

### Requirement: 一括保存結果の件数通知
システムはレス内画像の一括保存完了後に、成功件数と失敗件数を通知するSHALL。通知文言と判定条件は画像ビューアの保存結果通知と同一契約で処理しなければならないMUST。

#### Scenario: 成功件数と失敗件数を表示する
- **WHEN** 一括保存が完了する
- **THEN** 成功件数と失敗件数をユーザーへ通知する

#### Scenario: 画像ビューアと同一の結果判定で通知する
- **WHEN** 一括保存の結果として成功と失敗が混在する
- **THEN** システムは画像ビューアと同じ判定基準で部分成功の通知文言を表示する

### Requirement: 画像メニューアクション実行の共通化
システムはスレッド画面の画像メニューで選択されたアクション実行を、画像ビューアと共通の実行処理で行うMUST。保存アクションについては、URL正規化・権限判定・保留URL管理・保存実行・結果通知までを画像ビューアと同一フローで処理しなければならないMUST。

#### Scenario: 同一アクションで同一の副作用を実行する
- **WHEN** ユーザーがスレッド画面の画像メニューからコピー、共有、外部アプリ起動、Web検索、保存のいずれかを選択する
- **THEN** システムは画像ビューアと同じ実行契約に従って対象画像に対する処理を開始する

#### Scenario: 画像URLが空の場合は処理しない
- **WHEN** 対象画像URLが空または無効な状態で画像メニューアクションが発火する
- **THEN** システムは副作用処理を実行せず、クラッシュせずに処理を終了する

#### Scenario: 権限許可後に同一対象で保存を再開する
- **WHEN** 保存権限が必要な端末で、権限要求後にユーザーが許可する
- **THEN** システムは権限要求前に保持した同一URL集合で保存処理を再開する

